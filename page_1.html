<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì „ê³µí•™ê³¼ ì›”ë“œì»µ</title>
  <!-- âœ… ëª¨ë°”ì¼ ë·°í¬íŠ¸ ì¶”ê°€ -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- ë¨¸í‹°ë¦¬ì–¼ ì•„ì´ì½˜ (ì„ íƒì‚¬í•­: í™ˆ ì•„ì´ì½˜ ë“±) -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    /* í„°ì¹˜ í•˜ì´ë¼ì´íŠ¸ ì œê±° & ë°•ìŠ¤ì‚¬ì´ì§• í†µì¼(ëª¨ë°”ì¼ ë ˆì´ì•„ì›ƒ ì•ˆì •í™”) */
    * { box-sizing: border-box; }
    html, body { -webkit-tap-highlight-color: transparent; }

    body { font-size: 24px; font-family: sans-serif; text-align: center; margin: 0; background: #f9f9f9; }
    button, .btn { cursor: pointer; transition: transform .08s ease, box-shadow .15s; }
    button:active, .btn:active { transform: translateY(1px); }
    .material-icons { font-size: 24px; vertical-align: middle; }

    .input-container, .instruction, .category-select, .tournament, .result-area, .round-loading, .details-area { display: none; margin-top: 50px; }
    .instruction { max-width: 900px; margin: 50px auto 24px; text-align: left; line-height: 1.5em; padding: 0 24px }

    /* âœ… 100vh ì´ìŠˆ ë³´ì™„: ì£¼ì†Œì°½ ë†’ì´ ë³€í™” ëŒ€ì‘ */
    .input-container {
      display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px;
      height: 100vh;           /* ê¸°ì¡´ ê°’ ìœ ì§€(êµ¬í˜• ë¸Œë¼ìš°ì €) */
      min-height: 100dvh;      /* âœ… ëª¨ë°”ì¼ ì‹¤ì œ í™”ë©´ ë†’ì´ */
    }
    .input-container input, .input-container button { width: 300px; height: 48px; font-size: 18px; padding: 10px 16px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; }

    .category-select { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
    .bold-major { font-weight: bold; font-size: 48px; color: black; }
    .friend-text { font-size: 24px; color: #007ACC; margin-top: 30px; word-break: keep-all; overflow-wrap: break-word; white-space: normal; line-height: 1.5em; }

    .card { display: inline-block; width: 40%; margin: 20px; padding: 30px; border: 2px solid #aaa; border-radius: 10px; background: white; cursor: pointer; vertical-align: top; }
    .card-pair { display: flex; justify-content: center; align-items: stretch; gap: 40px; margin-bottom: 0; }

    .spinner { border: 8px solid #f3f3f3; border-top: 8px solid #555; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: auto; }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    table { margin: auto 60px; border-collapse: collapse; margin-top: 20px; }
    td, th { border: 1px solid #ccc; padding: 10px 10px; min-width: 120px; }

    #resultArea table.summary-table th:nth-child(2),
    #resultArea table.summary-table td:nth-child(2) { min-width: 200px; }

    #resultArea table.summary-table tr:not(:first-child) td:nth-child(3) { text-align: left; }

    #resultArea .results-note { font-size: 24px; color: #6b7280; margin: 12px 60px 18px; text-align: left; line-height: 1.5; }

    button { font-size: 24px; margin: 10px; padding: 10px 20px; }
    .circle-list { list-style: none; counter-reset: section; padding-left: 0; }
    .circle-list li { counter-increment: section; position: relative; padding-left: 1.5em; text-indent: 0; }
    .circle-list li::before { content: counter(section, upper-roman) "."; position: absolute; left: 0; width: 1.5em; display: inline-block; }
    .highlight-doc { color: #007ACC; font-weight: bold;}
    h1 { font-size: 28px; margin: 18px 0 18px; font-weight: bold; }

    .major-label { display: inline-flex; align-items: center; gap: 8px; }
    .major-label input[type="checkbox"] { transform: scale(1.1); }

    .details-area { display: none; max-width: 1200px; margin: 40px auto; text-align: left; }
    .detail-item { background: #fff; border: 1px solid #e5e7eb; border-radius: 12px; padding: 20px; margin: 18px 24px; box-shadow: 0 2px 8px rgba(0,0,0,.04); }
    .info-list { list-style: none; padding: 0; margin: 0; }
    .info-list li { margin: 8px 0; }
    .k { font-weight: 700; margin-right: 8px; }
    .v { white-space: pre-wrap; word-break: keep-all; line-height: 1.6; }
    .v-major { font-size: 1.05em; font-weight: 800; }
    .desc { margin-top: 6px; }
    .section-heading { display: flex; align-items: center; gap: 8px; margin: 14px 0 6px; font-weight: 800; }
    .section-heading .icon { font-size: 1.15em; }
    #detailsArea .toolbar { margin: 16px 24px; }

    /* âœ… ëª¨ë°”ì¼ ì „ìš© (ê°€ë¡œí­ 768px ì´í•˜) */
    @media (max-width: 768px) {
      .instruction { padding: 0 16px; }
      ul.circle-list { font-size: 18px; line-height: 1.6em; }

      /* ë²„íŠ¼/ì¹´í…Œê³ ë¦¬ ì¡°ì‘ì„± ê°œì„  */
      .category-select { flex-direction: column; align-items: stretch; gap: 12px; }
      .category-select button { width: 100%; }

      .card-pair { flex-direction: column; gap: 20px; align-items: center; }
      .card { width: 90%; max-width: 540px; margin: 10px 0; padding: 20px; font-size: 18px; }
      .bold-major { font-size: 24px; }
      .friend-text { font-size: 16px; margin-top: 20px; }

      #resultArea table { margin: 12px; width: calc(100% - 24px); table-layout: fixed; }
      #resultArea table.summary-table th,
      #resultArea table.summary-table td { padding: 8px 8px; font-size: 12px; word-break: break-word; }
      #resultArea table.summary-table th:nth-child(1),
      #resultArea table.summary-table td:nth-child(1) { width: 16%; }
      #resultArea table.summary-table th:nth-child(2),
      #resultArea table.summary-table td:nth-child(2) { width: 24%; min-width: 140px; }
      #resultArea table.summary-table tr:not(:first-child) td:nth-child(3) { text-align: left; white-space: normal; }
      #resultArea .results-note { font-size: 16px; margin: 8px 12px 12px; line-height: 1.6; }
      #resultArea { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    }

    /* âœ… ì´ˆì†Œí˜•(â‰¤360px) ë³´ì™„ */
    @media (max-width: 360px) {
      body { font-size: 20px; }
      h1 { font-size: 22px; }
      button { font-size: 18px; padding: 10px 14px; }
      .card { width: 96%; }
    }
  </style>
</head>
<body>
  <h1>ì „ê³µí•™ê³¼ ì´ìƒí˜• ì›”ë“œì»µ</h1>
  <div class="input-container" id="inputForm">
    <input id="school" placeholder="í•™êµëª…" />
    <div style="height:10px"></div>
    <input id="student_id" placeholder="í•™ë²ˆ" />
    <div style="height:10px"></div>
    <input id="student_name" placeholder="ì´ë¦„" />
    <div style="height:10px"></div>
    <button onclick="showInstruction()">ë‹¤ìŒ</button>
    <div style="height:10px"></div>
    <button onclick="goToIndex()"><span class="material-icons">home</span>ë©”ì¸ìœ¼ë¡œ</button>
  </div>

  <div class="instruction" id="instruction" style="max-width: 900px; margin: auto; text-align: left; line-height: 1.5em;">
    <ul class="circle-list">
      <li><b>ã€Œì „ê³µí•™ê³¼ ì›”ë“œì»µã€</b> í”„ë¡œê·¸ë¨ì€ ëŒ€í•™ ì „ê³µì— ëŒ€í•œ ê´€ì‹¬ ìˆ˜ì¤€ì„ ì•Œì•„ë³´ê¸° ìœ„í•´ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
      <li>ì„ íƒí•œ ê³„ì—´ì—ì„œ 2ê°œì˜ í•™ê³¼ê°€ ì§(pair)ì„ ì´ë£¨ì–´ ë³´ì—¬ì§€ë©°, ë” ê´€ì‹¬ìˆëŠ” í•™ê³¼ë¥¼ ì„ íƒí•˜ëŠ” í† ë„ˆë¨¼íŠ¸ ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.</li>
      <li><b>[ì¸ë¬¸+ê³µí†µ+ì²´ìœ¡], [ìì—°+ê³µí†µ] ì¤‘ í•˜ë‚˜</b>ë¥¼ ì„ íƒí•˜ì—¬ 64ê°•ë¶€í„° ì§„í–‰í•©ë‹ˆë‹¤.</li>
      <li><b>ê³µí†µ 8, ì¸ë¬¸ 43, ìì—° 56, ì²´ìœ¡ 5</b> ê°œì˜ ì „ê³µ í•™ê³¼ ëŒ€ìƒì´ë©°, [ì¸ë¬¸+ê³µí†µ+ì²´ìœ¡]ì€ ì„ì˜ë¡œ ì„ ì •ëœ 8ê°œ í•™ê³¼ê°€ ë¶€ì „ìŠ¹ìœ¼ë¡œ 32ê°•ì— í•©ë¥˜í•©ë‹ˆë‹¤.</li>
      <li>ë¼ìš´ë“œê°€ ì¢…ë£Œë˜ë©´, 8ê°•ê¹Œì§€ ì§„ì¶œí•œ ì „ê³µ í•™ê³¼ì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
    </ul>
    <div class="category-select">
      <button onclick="startCategory('inmun')">ì¸ë¬¸+ê³µí†µ+ì²´ìœ¡</button>
      <button onclick="startCategory('jayeon')">ìì—°+ê³µí†µ</button>
    </div>
  </div>

  <div class="round-loading" id="roundLoading">
    <div class="spinner"></div>
    <p id="roundText"></p>
  </div>

  <div class="tournament" id="tournament"></div>

  <div class="result-area" id="resultArea"></div>

  <!-- ìƒˆ â€œí˜ì´ì§€â€ ì—­í• ì˜ ìƒì„¸ ë³´ê¸° ì„¹ì…˜ -->
  <div class="details-area" id="detailsArea"></div>

  <!-- CSV íŒŒì„œ & ì•± ìœ í‹¸ (CSV_URLS, fetchSheetRows ë“±) -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="./assets/app.js"></script>

  <script>
    let roundData = [];     // í˜„ì¬ ë¼ìš´ë“œ í•­ëª© ë°°ì—´
    let roundResults = [];  // ë¼ìš´ë“œë³„ ìš”ì•½
    let roundHistory = [];  // ìµœê·¼ ë¼ìš´ë“œ ê¸°ë¡(ê²°ìŠ¹/4ê°•/8ê°• ì¶”ì¶œìš©)
    let userInfo = {};

    // ìƒì„¸ í˜ì´ì§€ìš© ì „ì²´ ì¸ë±ìŠ¤ â€” major â†’ item
    let dataIndex = new Map();

    // ë¶€ì „ìŠ¹/ë°”ì´ ê´€ë¦¬
    let autoPassList = [];      // inmun: 7ê°œ
    let hasAutoPass = false;    // inmun ì²« ë¼ìš´ë“œ ì¢…ë£Œ ì§í›„ 1íšŒ ì‚¬ìš©
    let firstRoundBye = null;   // inmun ì²« ë¼ìš´ë“œìš© ì¶”ê°€ ìë™ì§„ì¶œ 1ê°œ

    // ì•ˆì „ ì¶œë ¥ ìœ í‹¸
    function escapeHTML(str) {
      const map = { '&':'&amp;', '<':'&lt;', '>':'&gt;', '"':'&quot;', "'":'&#39;' };
      return String(str).replace(/[&<>"']/g, m => map[m]);
    }
    function escapeAttr(str) {
      return escapeHTML(str).replace(/`/g, '&#96;');
    }

    // ì§„ì… í™”ë©´ í‘œì‹œ
    document.getElementById('inputForm').style.display = 'block';

    // Enterë¡œ ì§„í–‰
    ['school','student_id','student_name'].forEach(id=>{
      document.getElementById(id).addEventListener('keydown', e=>{
        if(e.key==='Enter') showInstruction();
      });
    });

    // ë©”ì¸ìœ¼ë¡œ (GAS í˜¸ì¶œ â†’ ì •ì  í˜ì´ì§€ ì´ë™)
    function goToIndex() { location.href = './index.html'; }

    function showInstruction() {
      userInfo.school = document.getElementById('school').value || '';
      userInfo.id     = document.getElementById('student_id').value || '';
      userInfo.name   = document.getElementById('student_name').value || '';
      document.getElementById('inputForm').style.display = 'none';
      document.getElementById('instruction').style.display = 'block';
    }

    function shuffleArray(arr) { return [...arr].sort(() => Math.random() - 0.5); }

    function buildTournament(items) {
      if (items.length % 2 === 1) items = items.slice(0, items.length - 1);
      return shuffleArray(items);
    }

    function getRoundLabel(itemCount) {
      if (itemCount === 1) return 'ìµœì¢… ì„ íƒ ê²°ê³¼';
      if (itemCount === 2) return 'ê²°ìŠ¹';
      if (itemCount === 4) return '4ê°•';
      if (itemCount === 8) return '8ê°•';
      if (itemCount === 16) return '16ê°•';
      if (itemCount === 32) return '32ê°•';
      if (itemCount === 64) return '64ê°•';
      return `${itemCount}ê°•`;
    }

    function showLoading(name) {
      document.getElementById('roundText').innerText = `${name} ë¡œë”©ì¤‘...`;
      document.getElementById('roundLoading').style.display = 'block';
    }
    function hideLoading() {
      document.getElementById('roundLoading').style.display = 'none';
    }

    /** ì¹´í…Œê³ ë¦¬ ì‹œì‘: CSVì—ì„œ ë°ì´í„° ë¡œë“œ (ì•Œê³ ë¦¬ì¦˜ì€ ê·¸ëŒ€ë¡œ) */
    function startCategory(sheetName) {
      document.getElementById('instruction').style.display = 'none';
      document.getElementById('resultArea').style.display = 'none';
      document.getElementById('detailsArea').style.display = 'none';
      showLoading('ë°ì´í„°');

      // ğŸ” GAS â†’ CSV ë¡œë”ë¡œ êµì²´ (assets/app.jsì˜ fetchSheetRows ì‚¬ìš©)
      fetchSheetRows(sheetName).then((data) => {
        if (!Array.isArray(data) || data.length === 0) {
          alert('ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
          hideLoading();
          return;
        }
        data = shuffleArray(data);

        if (sheetName === 'inmun') {
          // 56ê°œ ì‚¬ìš©: ë¶€ì „ìŠ¹ 7, ë‚˜ë¨¸ì§€ 49 ì¤‘ 1ê°œëŠ” â€˜ë°”ì´â€™, 48ê°œë¡œ 64ê°• ì§„í–‰
          const selected = data.slice(0, 56);
          autoPassList   = selected.slice(0, 7);
          const remain49 = selected.slice(7, 56);
          const shuffledRemain = shuffleArray(remain49);
          firstRoundBye  = shuffledRemain[0];
          const others48 = shuffledRemain.slice(1);
          roundData      = buildTournament(others48);
          hasAutoPass    = true;

          // ìƒì„¸ìš© ì¸ë±ìŠ¤(ì„ íƒëœ 56ê°œ ì „ì²´)
          dataIndex = new Map(selected.map(it => [it.major, it]));
        } else {
          // jayeon: 64ê°œ ë°”ë¡œ
          const used = data.slice(0, 64);
          roundData   = buildTournament(used);
          hasAutoPass = false;
          autoPassList = [];
          firstRoundBye = null;

          dataIndex = new Map(used.map(it => [it.major, it]));
        }

        hideLoading();
        document.getElementById('tournament').style.display = 'block';
        playRound(roundData);
      }).catch((err) => {
        console.error(err);
        alert('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + (err && err.message ? err.message : err));
        hideLoading();
      });
    }

    // ì¹´ë“œ ë†’ì´ ë™ê¸°í™”
    function equalizeHeights(a, b){
      if (window.innerWidth <= 768) { a.style.height = ''; b.style.height = ''; return; }
      requestAnimationFrame(()=>requestAnimationFrame(()=>{
        const maxH = Math.max(a.offsetHeight, b.offsetHeight);
        a.style.height = b.style.height = `${maxH}px`;
      }));
    }

    function playRound(items) {
      const container = document.getElementById('tournament');
      container.innerHTML = '';

      if (items.length === 1) {
        saveRoundResult(items[0]);
        showSummary();
        return;
      }

      roundData = items;
      roundHistory.push([...items]);

      const nextRound = [];
      let index = 0;

      showLoading(getRoundLabel(items.length));
      setTimeout(() => { hideLoading(); nextPair(); }, 300);

      function nextPair() {
        container.innerHTML = '';

        if (index >= items.length) {
          let nextItems = nextRound;

          // inmun: 24 ìŠ¹ì + ë°”ì´1 + ë¶€ì „ìŠ¹7 = 32
          if (items.length === 48 && hasAutoPass) {
            if (firstRoundBye) nextItems = [...nextItems, firstRoundBye];
            if (autoPassList && autoPassList.length === 7) nextItems = [...nextItems, ...autoPassList];
            firstRoundBye = null; autoPassList = []; hasAutoPass = false;
            nextItems = shuffleArray(nextItems);
          }

          const nextLabel = getRoundLabel(nextItems.length);
          showLoading(nextLabel);
          setTimeout(() => { hideLoading(); playRound(nextItems); }, 600);
          return;
        }

        if (index === items.length - 1) {
          nextRound.push(items[index]);
          index += 1;
          nextPair();
          return;
        }

        const a = items[index];
        const b = items[index + 1];
        const cardA = createCard(a);
        const cardB = createCard(b);

        const wrapper = document.createElement('div');
        wrapper.className = 'card-pair';
        wrapper.appendChild(cardA);
        wrapper.appendChild(cardB);
        container.appendChild(wrapper);

        equalizeHeights(cardA, cardB);

        cardA.onclick = () => { nextRound.push(a); index += 2; nextPair(); };
        cardB.onclick = () => { nextRound.push(b); index += 2; nextPair(); };
      }
    }

    function createCard(item) {
      const div = document.createElement('div');
      div.className = 'card';
      div.innerHTML = `
        <div class='bold-major'>${escapeHTML(item.major)}</div>
        <div class='friend-text'>${escapeHTML(item.friends || '')}</div>
      `;
      return div;
    }

    function saveRoundResult(winner) {
      const last1 = roundHistory[roundHistory.length - 1] || [];
      const last2 = roundHistory[roundHistory.length - 2] || [];
      const last3 = roundHistory[roundHistory.length - 3] || [];
      const finals   = last1.slice(0, 2);
      const semis    = last2.slice(0, 4);
      const quarters = last3.slice(0, 8);
      roundResults.push({ final: winner, finals, semis, quarters });
    }

    function showSummary() {
      document.getElementById('tournament').style.display = 'none';
      const result = document.getElementById('resultArea');
      result.style.display = 'block';

      let html = `<p><span class="highlight-doc">${escapeHTML(userInfo.school)} ${escapeHTML(userInfo.id)} ${escapeHTML(userInfo.name)} ë‹˜ì˜ ì „ê³µ í•™ê³¼ ì›”ë“œì»µ ê²°ê³¼</span></p>`;

      roundResults.forEach((round) => {
        const finalsOthers = round.finals.filter(x => x.major !== round.final.major);
        const semisOnly    = round.semis.filter(x => !round.finals.includes(x));
        const quartersOnly = round.quarters.filter(x => !round.semis.includes(x));

        html += ` <span class="highlight-doc">í† ë„ˆë¨¼íŠ¸ 8ê°•ê¹Œì§€ ì§„ì¶œí•œ ì „ê³µ í•™ê³¼ ì…ë‹ˆë‹¤.</span>
        <table class="summary-table">
          <tr><th>êµ¬ë¶„</th><th>ì „ê³µ</th><th>ìœ ì‚¬í•™ê³¼</th></tr>`;

        const majorCell = (item) => `
          <label class="major-label">
            <input type="checkbox" class="major-select" value="${escapeAttr(item.major)}">
            ${escapeHTML(item.major)}
          </label>`;

        html += `<tr><td>ìµœì¢… ì„ íƒ</td><td>${majorCell(round.final)}</td><td>${escapeHTML(round.final.friends || '')}</td></tr>`;
        finalsOthers.forEach(item => {
          html += `<tr><td>ê²°ìŠ¹ ì§„ì¶œ</td><td>${majorCell(item)}</td><td>${escapeHTML(item.friends || '')}</td></tr>`;
        });
        semisOnly.forEach(item => {
          html += `<tr><td>4ê°• ì§„ì¶œ</td><td>${majorCell(item)}</td><td>${escapeHTML(item.friends || '')}</td></tr>`;
        });
        quartersOnly.forEach(item => {
          html += `<tr><td>8ê°• ì§„ì¶œ</td><td>${majorCell(item)}</td><td>${escapeHTML(item.friends || '')}</td></tr>`;
        });

        html += `</table>`;
      });

      html += `
        <div class="results-note">
          â€» ê´€ì‹¬ ìˆëŠ” ì „ê³µ í•™ê³¼ì— ì²´í¬ ë°•ìŠ¤ í‘œì‹œ í›„, ì•„ë˜ <b>ã€Œì „ê³µ ê´€ë ¨ ì„ íƒê³¼ëª© ë³´ê¸°ã€</b> ë²„íŠ¼ì„ í´ë¦­í•´ ì£¼ì„¸ìš”.
        </div>
        <div class="toolbar">
          <button id="showSubjectsBtn"> <span class="material-icons">menu_book</span> ì „ê³µ ê´€ë ¨ ì„ íƒê³¼ëª© ë³´ê¸°</button>
          <button id="printResultBtn"> <span class="material-icons">print</span> ì¸ì‡„í•˜ê¸°</button>
          <button onclick="backToIndex()"> <span class="material-icons">sports_esports</span> ë‹¤ì‹œ í•˜ê¸°</button>
        </div>`;
      result.innerHTML = html;

      document.getElementById('printResultBtn').onclick = () => window.print();
      document.getElementById('showSubjectsBtn').onclick = showSelectedSubjects;
    }

    function showSelectedSubjects() {
      const checked = Array.from(document.querySelectorAll('.major-select:checked')).map(cb => cb.value);
      const uniqueMajors = Array.from(new Set(checked));
      if (uniqueMajors.length === 0) { alert('ì „ê³µì„ í•˜ë‚˜ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }
      const items = uniqueMajors.map(m => dataIndex.get(m)).filter(Boolean);
      renderDetails(items);
    }

    function renderDetails(items) {
      const area = document.getElementById('detailsArea');
      document.getElementById('resultArea').style.display = 'none';
      area.style.display = 'block';

      let html = `<h3>ì„ íƒ ì „ê³µ í•™ê³¼ ê´€ë ¨ ì •ë³´</h3>`;

      items.forEach(it => {
        const guideName = (it.major_ref && String(it.major_ref).trim()) ? it.major_ref : it.major;

        html += `
          <section class="detail-item">
            <ol class="info-list">
              <li><span class="k">1. ì „ê³µí•™ê³¼:</span> <span class="v v-major">${escapeHTML(it.major || '')}</span></li>
              <li><span class="k">2. ê³¼ëª© ì„ íƒì•ˆë‚´ì„œ í‘œê¸° í•™ê³¼ëª…:</span> <span class="v">${escapeHTML(guideName || '')}</span></li>
              <li>
                <span class="k">3. í•™ê³¼ ê°œìš”:</span>
                <div class="v desc">${escapeHTML(it.desc || '')}</div>
              </li>
            </ol>
            <br>

            <div class="section-heading"><span class="icon">ğŸ“˜</span><span>ê³¼ëª© ì„ íƒ</span></div>
            <ul class="info-list">
              <li><span class="k">4. ì¼ë°˜ ì„ íƒ ê³¼ëª©:</span> <span class="v">${escapeHTML(it.sub1 || '')}</span></li>
              <li><span class="k">5. ì§„ë¡œ ì„ íƒ ê³¼ëª©:</span> <span class="v">${escapeHTML(it.sub2 || '')}</span></li>
              <li><span class="k">6. ìœµí•© ì„ íƒ ê³¼ëª©:</span> <span class="v">${escapeHTML(it.sub3 || '')}</span></li>
            </ul>
            <br>

            <div class="section-heading"><span class="icon">ğŸ“</span><span>ì „ê³µ í•™ê³¼ ê°œì„¤ ëŒ€í•™</span></div>
            <div class="v"> :  ${escapeHTML(it.univ || '')}</div>
          </section>
        `;
      });

      html += `
        <div class="toolbar">
          <button id="backToResultsBtn">â—€ ê²°ê³¼ë¡œ ëŒì•„ê°€ê¸°</button>
          <button id="detailsPrintBtn"><span class="material-icons">print</span>ì¸ì‡„í•˜ê¸°</button>
        </div>`;

      area.innerHTML = html;

      document.getElementById('backToResultsBtn').onclick = () => {
        area.style.display = 'none';
        document.getElementById('resultArea').style.display = 'block';
      };
      document.getElementById('detailsPrintBtn').onclick = () => window.print();
    }

    function backToIndex(){
      roundData = []; roundResults = []; roundHistory = [];
      autoPassList = []; hasAutoPass = false; firstRoundBye = null;
      dataIndex = new Map();
      document.getElementById('resultArea').style.display='none';
      document.getElementById('detailsArea').style.display='none';
      document.getElementById('tournament').style.display='none';
      document.getElementById('instruction').style.display='none';
      document.getElementById('inputForm').style.display='block';
    }

    /* ê°€ë¡œâ†”ì„¸ë¡œ ì „í™˜ ì‹œ ë°ìŠ¤í¬í†±ì—ì„œ ê³ ì •ëë˜ ì¹´ë“œ ë†’ì´ë¥¼ ëª¨ë°”ì¼ì—ì„œ í•´ì œ */
    window.addEventListener('resize', () => {
      if (window.innerWidth <= 768) {
        document.querySelectorAll('.card').forEach(el => el.style.height = '');
      }
    });

    // ì˜¤ë¥¸ìª½ í´ë¦­ ë°©ì§€
    document.addEventListener('contextmenu', e => e.preventDefault());
  </script>
</body>
</html>
