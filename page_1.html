<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì „ê³µí•™ê³¼ ì›”ë“œì»µ â€“ í† ë„ˆë¨¼íŠ¸</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f9fafb; --card:#fff; --border:#e5e7eb; --text:#111827;
      --muted:#6b7280; --primary:#2563eb; --ring: rgba(37,99,235,.35);
    }
    *{box-sizing:border-box} body{margin:0;font-family:'Noto Sans KR',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:1000px;margin:28px auto;padding:0 16px}
    header{display:flex;justify-content:space-between;align-items:center;margin:8px 0 16px}
    .brand{font-weight:800}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.04);padding:18px}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    button,a.btn{appearance:none;border:1px solid var(--primary);background:var(--primary);color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer;text-decoration:none;font-weight:700}
    .secondary{background:#fff;color:var(--primary)}
    .pill{font-size:12px;color:var(--muted);border:1px solid var(--border);border-radius:9999px;padding:2px 8px;background:#fff}
    .vs{display:grid;grid-template-columns:1fr auto 1fr;gap:12px;margin-top:14px}
    .opt{border:1px solid var(--border);border-radius:12px;padding:14px;background:#fff;min-height:120px;display:flex;flex-direction:column;justify-content:space-between}
    .opt h3{margin:0 0 6px;font-size:18px}
    .opt p{margin:0;color:var(--muted);font-size:13px}
    .opt button{margin-top:10px}
    .center{display:flex;align-items:center;justify-content:center;color:var(--muted);font-weight:800}
    .progress{margin-top:10px;color:var(--muted);font-size:13px}
    .winner{font-size:20px;font-weight:900}
    .hidden{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">ì „ê³µí•™ê³¼ ì›”ë“œì»µ <span class="pill">CSV ëª¨ë“œ</span></div>
      <div class="row">
        <a class="btn secondary" href="./index.html">í™ˆ</a>
      </div>
    </header>

    <div class="card">
      <div class="row">
        <button onclick="startCategory('inmun')">ì¸ë¬¸ ì‹œì‘</button>
        <button class="secondary" onclick="startCategory('jayeon')">ìì—° ì‹œì‘</button>
        <span class="pill" id="sheetBadge">ì‹œì‘ ì „</span>
      </div>

      <div id="loading" class="progress hidden">ë°ì´í„° ë¡œë”© ì¤‘â€¦</div>

      <div id="stage" class="hidden">
        <div class="progress" id="roundInfo"></div>
        <div class="vs" id="vsBox">
          <!-- ë‘ ì˜µì…˜ ì¹´ë“œê°€ ì—¬ê¸° ë Œë”ë§ ë©ë‹ˆë‹¤ -->
        </div>
      </div>

      <div id="result" class="hidden">
        <div class="winner">ğŸ† ìš°ìŠ¹ ì „ê³µ</div>
        <div id="winnerText" style="margin-top:8px"></div>
        <div class="row" style="margin-top:12px">
          <button onclick="restart()">ë‹¤ì‹œ í•˜ê¸°</button>
          <a class="btn secondary" href="./page_2.html">ê³¼ëª©/ìƒì„¸ ë³´ê¸°</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ë¼ì´ë¸ŒëŸ¬ë¦¬ & ê³µí†µ ë¡œë” -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="./assets/app.js"></script>

  <script>
    // í˜ì´ì§€ ê³µìš© ë¡œë”© í‘œì‹œ í•¨ìˆ˜ (assets/app.jsì—ì„œ í˜¸ì¶œ ê°€ëŠ¥í•˜ê²Œ ì „ì—­ ì œê³µ)
    function showLoading(msg){ const el=document.getElementById('loading'); el.textContent=msg||'ë¡œë”© ì¤‘â€¦'; el.classList.remove('hidden'); }
    function hideLoading(){ document.getElementById('loading').classList.add('hidden'); }

    // ê°„ì´ í† ë„ˆë¨¼íŠ¸ ìƒíƒœ
    let CURRENT = { items:[], round:1, pairs:[], idx:0, winners:[], sheetKey:null };

    function restart(){
      document.getElementById('result').classList.add('hidden');
      document.getElementById('stage').classList.add('hidden');
      document.getElementById('sheetBadge').textContent = 'ì‹œì‘ ì „';
    }

    // assets/app.jsê°€ ë°ì´í„° ë¡œë”©ì„ ëë‚´ë©´ ì´ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ë„ë¡ ì„¤ê³„ë¨.
    // (app.jsì˜ startCategory()ê°€ items, sheetKeyë¥¼ ë„˜ê¹€)
    function startTournament(items, sheetKey){
      CURRENT.sheetKey = sheetKey;
      document.getElementById('sheetBadge').textContent = (sheetKey === 'inmun' ? 'ì¸ë¬¸' : 'ìì—°');

      // ìµœì†Œ 2ê°œë§Œ ìˆìœ¼ë©´ ì§„í–‰. ë§ì„ìˆ˜ë¡ ìë™ í˜ì–´ë§
      CURRENT.items = shuffle(items.slice()); // ì–•ì€ë³µì‚¬ í›„ ì…”í”Œ
      CURRENT.round = 1;
      makePairs();
      document.getElementById('result').classList.add('hidden');
      document.getElementById('stage').classList.remove('hidden');
      CURRENT.idx = 0;
      renderPair();
    }

    function makePairs(){
      const arr = CURRENT.items.slice();
      // í™€ìˆ˜ë©´ ë§ˆì§€ë§‰ í•˜ë‚˜ ë¶€ì „ìŠ¹ ì²˜ë¦¬
      if (arr.length % 2 === 1) arr.push({ __bye: true, ...arr[arr.length-1] });
      CURRENT.pairs = [];
      for (let i=0; i<arr.length; i+=2){
        CURRENT.pairs.push([arr[i], arr[i+1]]);
      }
      CURRENT.winners = [];
      document.getElementById('roundInfo').textContent = `Round ${CURRENT.round} Â· ì°¸ê°€ ${arr.length}ê°œ / ë§¤ì¹˜ ${CURRENT.pairs.length}ê°œ`;
    }

    function pick(who){
      const pair = CURRENT.pairs[CURRENT.idx];
      const chosen = (who === 0 ? pair[0] : pair[1]);
      CURRENT.winners.push(chosen.__bye ? pair[0] : chosen);
      CURRENT.idx++;
      if (CURRENT.idx >= CURRENT.pairs.length){
        // ë¼ìš´ë“œ ì¢…ë£Œ â†’ ë‹¤ìŒ ë¼ìš´ë“œ ì¤€ë¹„
        if (CURRENT.winners.length === 1){
          // ìš°ìŠ¹
          showWinner(CURRENT.winners[0]);
          return;
        }
        CURRENT.items = CURRENT.winners.slice();
        CURRENT.round++;
        makePairs();
        CURRENT.idx = 0;
      }
      renderPair();
    }

    function renderPair(){
      const vs = document.getElementById('vsBox');
      const pair = CURRENT.pairs[CURRENT.idx];
      const a = pair[0], b = pair[1];
      vs.innerHTML = `
        <div class="opt">
          <div>
            <h3>${escapeHTML(a.major || '(ë¬´ëª… ì „ê³µ)')}</h3>
            <p>${escapeHTML(a.friends || '')}</p>
          </div>
          <button onclick="pick(0)">ì„ íƒ</button>
        </div>
        <div class="center">VS</div>
        <div class="opt">
          <div>
            <h3>${escapeHTML(b.major || (b.__bye ? 'ë¶€ì „ìŠ¹' : '(ë¬´ëª… ì „ê³µ)'))}</h3>
            <p>${escapeHTML(b.friends || '')}</p>
          </div>
          <button onclick="pick(1)">ì„ íƒ</button>
        </div>`;
    }

    function showWinner(item){
      document.getElementById('stage').classList.add('hidden');
      document.getElementById('result').classList.remove('hidden');
      const text = `
        <div><b>${escapeHTML(item.major || '(ìš°ìŠ¹ ì „ê³µ)')}</b></div>
        <div style="color:#6b7280;margin-top:6px">${escapeHTML(item.friends || '')}</div>
      `;
      document.getElementById('winnerText').innerHTML = text;
    }

    function shuffle(a){
      for (let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; }
      return a;
    }
    function escapeHTML(s){ return String(s??'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;' }[m])); }
  </script>
</body>
</html>
