<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>전공학과 월드컵 – 과목/상세 보기</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg:#f9fafb; --card:#fff; --border:#e5e7eb; --text:#111827;
      --muted:#6b7280; --primary:#2563eb; --ring: rgba(37,99,235,.35);
    }
    *{box-sizing:border-box} body{margin:0;font-family:'Noto Sans KR',system-ui,-apple-system,sans-serif;background:var(--bg);color:var(--text)}
    .wrap{max-width:1100px;margin:28px auto;padding:0 16px}
    header{display:flex;justify-content:space-between;align-items:center;margin:8px 0 16px}
    .brand{font-weight:800}
    .pill{font-size:12px;color:var(--muted);border:1px solid var(--border);border-radius:9999px;padding:2px 8px;background:#fff}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.04);padding:18px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    input,select{height:40px;padding:8px 12px;border:1px solid var(--border);border-radius:10px;outline:none}
    input:focus,select:focus{border-color:var(--primary);box-shadow:0 0 0 4px var(--ring)}
    button,a.btn{appearance:none;border:1px solid var(--primary);background:var(--primary);color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer;text-decoration:none;font-weight:700}
    .secondary{background:#fff;color:var(--primary)}
    table{width:100%;border-collapse:collapse;margin-top:10px;background:#fff}
    th,td{border-bottom:1px solid var(--border);padding:10px 12px;text-align:left;vertical-align:top}
    th{background:#f3f4f6;font-weight:800}
    .muted{color:var(--muted)}
    .hidden{display:none}
    .count{font-size:12px;color:var(--muted)}
    .nowrap{white-space:nowrap}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">과목/상세 보기 <span id="badge" class="pill">시작 전</span></div>
      <div class="row">
        <a class="btn secondary" href="./index.html">홈</a>
        <button onclick="loadSubjects('inmun')">인문 불러오기</button>
        <button class="secondary" onclick="loadSubjects('jayeon')">자연 불러오기</button>
      </div>
    </header>

    <div class="card">
      <div class="row" style="margin-bottom:8px">
        <input id="q" placeholder="검색: 전공/유사학과/설명" style="flex:1;min-width:220px" />
        <select id="type">
          <option value="">계열 전체</option>
          <option value="인문">인문</option>
          <option value="자연">자연</option>
        </select>
        <span class="count" id="count">0건</span>
      </div>

      <div id="loading" class="muted hidden">데이터 로딩 중…</div>

      <div style="overflow:auto">
        <table id="tbl">
          <thead>
            <tr>
              <th class="nowrap">#</th>
              <th>전공</th>
              <th>유사학과</th>
              <th>설명</th>
              <th class="nowrap">과목</th>
              <th>대표대학</th>
              <th class="nowrap">계열</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- 라이브러리 & 공통 로더 -->
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <script src="./assets/app.js"></script>

  <script>
    function showLoading(msg){ const el=document.getElementById('loading'); el.textContent=msg||'로딩 중…'; el.classList.remove('hidden'); }
    function hideLoading(){ document.getElementById('loading').classList.add('hidden'); }

    let SUBJECTS = []; // 정규화된 items 캐시

    function renderSubjects(items){
      SUBJECTS = items.slice();
      document.getElementById('badge').textContent = guessType(items);
      bindFilters();
      applyFilters();
    }

    function bindFilters(){
      const q = document.getElementById('q');
      const type = document.getElementById('type');
      q.oninput = applyFilters;
      type.onchange = applyFilters;
    }

    function applyFilters(){
      const qv = (document.getElementById('q').value || '').toLowerCase();
      const tv = document.getElementById('type').value || '';
      const rows = SUBJECTS.filter(r => {
        if (tv && (r.major_type||'') !== tv) return false;
        if (!qv) return true;
        const blob = [
          r.major, r.friends, r.desc, r.sub1, r.sub2, r.sub3, r.univ
        ].join(' ').toLowerCase();
        return blob.includes(qv);
      });
      paintTable(rows);
      document.getElementById('count').textContent = `${rows.length}건`;
    }

    function paintTable(rows){
      const tb = document.querySelector('#tbl tbody');
      tb.innerHTML = rows.map((r, i) => `
        <tr>
          <td class="nowrap">${i+1}</td>
          <td><b>${escapeHTML(r.major||'')}</b><div class="muted">${escapeHTML(r.major_ref||'')}</div></td>
          <td>${escapeHTML(r.friends||'')}</td>
          <td>${escapeHTML(r.desc||'')}</td>
          <td class="nowrap">
            ${escapeHTML(r.sub1||'')}${r.sub2? ', '+escapeHTML(r.sub2):''}${r.sub3? ', '+escapeHTML(r.sub3):''}
          </td>
          <td>${escapeHTML(r.univ||'')}</td>
          <td class="nowrap">${escapeHTML(r.major_type||'')}</td>
        </tr>
      `).join('');
    }

    function guessType(items){
      const types = new Set(items.map(x=>x.major_type).filter(Boolean));
      if (types.size === 1) return [...types][0];
      return `혼합(${types.size})`;
    }

    function escapeHTML(s){ return String(s??'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;', "'":'&#39;' }[m])); }

    // URL 파라미터로 자동 로드 (index에서 넘긴 값은 이 페이지에선 사용하지 않지만 틀만 유지)
    (function autoLoadByParam(){
      const u = new URL(location.href);
      const auto = u.searchParams.get('auto'); // ?auto=inmun 같이 쓸 수 있음
      if (auto === 'inmun' || auto === 'jayeon'){
        loadSubjects(auto);
      }
    })();
  </script>
</body>
</html>
